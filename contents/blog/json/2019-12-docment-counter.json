{
  "title": "VueCLIã¨Firebaseã‚’ä½¿ã£ã¦ã€åŸç¨¿ç”¨ç´™ã®ä¸‹æ›¸ããŒã§ãã¦ç· ã‚åˆ‡ã‚Šã‚’é€šçŸ¥ã—ã¦ãã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚’ã¤ãã£ã¦ã¿ãŸ",
  "created_at": "2019-12-17T00:00:00.000Z",
  "slug": "docment-counter",
  "category": {
    "name": "tech",
    "slug": "tech"
  },
  "tags": [
    {
      "name": "Vue.js",
      "slug": "vue"
    }
  ],
  "description": "Vue.jsã¨Firebaseã‚’åˆ©ç”¨ã—ã¦PWAã§Pushé€šçŸ¥ãŒãã‚‹ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚ã–ã£ãã‚Šå®Ÿè£…ã—ãŸã“ã¨ãªã©ã‚’ã”ç´¹ä»‹ã—ã¾ã™m(_ _)m",
  "bodyContent": "ã“ã®è¨˜äº‹ã¯[North Detail Advent Calendar 2019](https://qiita.com/advent-calendar/2019/northdetail)17æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚\n\n\n*â€»èª¬æ˜ã®ãŸã‚ã«ã„ãã¤ã‹ã‚³ãƒ¼ãƒ‰ã‚’è¼‰ã›ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã«ä½œæˆã—ãŸã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰(Github)ã¨ã¯ä¼¼ã¦ç•°ãªã‚Šã¾ã™ã€‚*\n\n## æ¦‚è¦\nå­¦ç”Ÿæ™‚ä»£ã«æ‰‹æ›¸ããƒ¬ãƒãƒ¼ãƒˆã®ä¸‹æ›¸ãã‚’PCã§æ‰“ã¡è¾¼ã‚“ã§ã„ãŸã®ã§ã™ãŒã€å®Ÿéš›ã«ãƒã‚¹ç›®ã«å½“ã¦ã¯ã‚ã‚‹ã¨æ®µè½ã®åˆ‡ã‚Šæ›¿ãˆã‚„ã€æ•°å­—ã‚’1ãƒã‚¹ã«2ã¤å…¥ã‚Œã‚‹...etcãªã©ã®ãƒ«ãƒ¼ãƒ«ãŒã‚ã£ãŸã‚Šã—ã¦ã€æ–‡å­—æ•°ï¼ãƒã‚¹ç›®ã®æ•°ã«ãªã‚‰ãªã„ã®ã§ã€PCã§ä¸‹æ›¸ãã‚’ã—ã¦æ–‡å­—æ•°ã‚’åŸç¨¿ç”¨ç´™ã«ã‚ã‚ã›ã¦ã‚‚ã€çµå±€æ–‡ç« ã®é•·ã•ãŒå¤šã™ããŸã‚Šã€é€†ã«è¶³ã‚Šãªã‹ã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒå¤šã€…ã‚ã‚Šã¾ã—ãŸã€‚\nã¨ã„ã†ã“ã¨ã§ã€æ‰“ã¡è¾¼ã‚“ã æ–‡ç« ã‚’åŸç¨¿ç”¨ç´™ã«å½“ã¦ã¯ã‚ãŸã‚ˆã†ã«ã—ã¦è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚\n\n## ä½œã£ãŸã‚‚ã®\n\n- å…¥åŠ›ã—ãŸæ–‡ç« ãŒåŸç¨¿ç”¨ç´™ã«åã¾ã‚‹ã‹ã©ã†ã‹ã‚’ã€å®Ÿéš›ã«ãƒã‚¹ç›®ã«ç´ã‚ã¦ã‚«ã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚\n- ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ã‚«ã‚¦ãƒ³ãƒˆã—ãŸçµæœã‚’ä¿å­˜ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n- ç· åˆ‡æ—¥ã‚’è¨­å®šã™ã‚‹ã¨ç· ã‚åˆ‡ã‚Šå‰æ—¥ã¨å½“æ—¥ã«Pushé€šçŸ¥ãŒå±Šãã¾ã™ã€‚(8:00ã¨17:00ã«é€šçŸ¥)\n\n![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-12-04 19.01.40ï¼ˆ2ï¼‰.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/538820/de3542d5-7b5f-635e-3c38-5d11d3c3e53b.png)\n![ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-12-04 19.02.23ï¼ˆ2ï¼‰.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/538820/a9ae857f-336a-5aa3-bd04-ccbe8f39dda3.png)\n\n\n\næ–‡å­—æ•°ã‚ªãƒ¼ãƒãƒ¼ã—ãŸç®‡æ‰€ã¯èµ¤ã„ãƒã‚¹ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\nã€Œæ®µè½ã®é ­ã‚’1ãƒã‚¹é–‹ã‘ã‚‹ã€ã€ã€Œæ‹¬å¼§ã‚’ä»–ã®æ–‡å­—ã¨åŒã˜ã¾ã™ã«å…¥ã‚Œã‚‹ã€ãªã©ã€å®Ÿéš›ã®åŸç¨¿ç”¨ç´™ã®ãƒ«ãƒ¼ãƒ«ã«å‰‡ã£ãŸæ›¸å¼è¨­å®šãŒã§ãã‚‹ã®ã§ã€æ‰“ã£ãŸæ–‡ç« ãŒåŸç¨¿ç”¨ç´™ä½•æšåˆ†ã«åã¾ã‚‹ã®ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n\n- [Demo](https://document-paper-counter-81e10.firebaseapp.com/)\n- [Git](https://github.com/shunsato1231/document-paper-counter)\n\n## å®Ÿè£…ã—ãŸæ©Ÿèƒ½ã¨ã€å®Ÿè£…å†…å®¹ã®æ¦‚è¦\n### æ–‡å­—ã®ã‚«ã‚¦ãƒ³ãƒˆ\n1. å…¥åŠ›ã—ãŸæœ¬æ–‡ã¨ã€åŸç¨¿ç”¨ç´™ã®æ›¸å¼è¨­å®šã‚’Vuex Storeã«æ ¼ç´\n2. Vuexã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å…¥åŠ›ã—ãŸæ–‡å­—ã‚’é…åˆ—ã«åˆ†å‰²ã—ã€(é…åˆ—1ã¤ã«åŸç¨¿ç”¨ç´™ã²ã¨ã¾ã™åˆ†ã®æ–‡å­—ã‚’æ ¼ç´)Vuex Storeã«æ ¼ç´\n3. é…åˆ—ã«æ ¼ç´ã•ã‚ŒãŸæ–‡å­—ã‚’åŸç¨¿ç”¨ç´™é¢¨ã«è¡¨ç¤º\n\n### ã‚«ã‚¦ãƒ³ãƒˆã—ãŸæ–‡ç« ã®ä¿å­˜\nå…¥åŠ›ã—ãŸæ–‡ç« ã¨ã€åŸç¨¿ç”¨ç´™ã®æ›¸å¼è¨­å®šã‚’FireStoreã«ã¦ç®¡ç†ã€‚\n\n### é€šçŸ¥å‡¦ç†\n1. åŸç¨¿ç”¨ç´™é¢¨ã«è¡¨ç¤ºã™ã‚‹ç”»é¢ã§ã€ã€Œé€šçŸ¥ã™ã‚‹ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’æŠ¼ã—ãŸæ™‚ã«é€šçŸ¥ç”¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—\n2. ä¿å­˜æ™‚ã«ã€é€šçŸ¥ç”¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜\n3. FirebaseFunctionsã§pushé€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹é–¢æ•°ã‚’ä½œæˆ\n3. å¤–éƒ¨ã®Cronã‚’åˆ©ç”¨ã—ã¦ã€æ¯æ—¥8:00ã¨17:00ã«FirebaseFunctionsã§ä½œæˆã—ãŸpushé€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹é–¢æ•°ã‚’å®Ÿè¡Œ\n\n\n## å®Ÿè£…ã®æ‰‹é †\n\nå¤§ã¾ã‹ã«ã§ã™ãŒã€å®Ÿè£…ã®æ‰‹é †ã«ã¤ã„ã¦ç´¹ä»‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\n\n## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ\nyarnãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å‰æã§ã™ã€‚\n\n### 1-1. Vue Cliã‚’ä½¿ã£ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ\n\n```sh\n// vueCLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\nyarn global add @vue/cli\n\n// æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ\nvue create <ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå>\n```\nä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã€‚\n\nãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä½¿ã†ã‹ã€æ‰‹å‹•ã§é¸æŠã™ã‚‹ã‹ã‚’èã‹ã‚Œã‚‹ã®ã§ `Manually select features` ã‚’é¸æŠã€‚\n\n```sh\n? Please pick a preset: \n  default (babel, eslint) \nâ¯ Manually select features \n```\n\nç¶šãè¨­å•ã‚‚ä¸‹è¨˜ã®ã‚ˆã†ã«é¸æŠã€‚\n\n```sh\n? Check the features needed for your project: \nâ¯ â—‰ Babel\n  â—¯ TypeScript\nâ¯ â—‰ Progressive Web App (PWA) Support\nâ¯ â—‰ Router\nâ¯ â—‰ Vuex\nâ¯ â—‰ CSS Pre-processors\nâ¯ â—‰ Linter / Formatter\n  â—¯ Unit Testing\n  â—¯ E2E Testing\n\n? Use history mode for router? (Requires proper server setup for index fallback in production)\nâ¯ Yes\n\n? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default)\nâ¯ Scss\n\n? Pick a linter / formatter config\nâ¯ ESLint with error prevention only \n\n? Pick additional lint features: (Press <space> to select, <a> to toggle all, <i> to invert selection)\nâ¯ Lint on save\n\n? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? \nâ¯ In dedicated config files\n```\n\n\nã“ã‚Œã§Vueãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é››å½¢ãŒç”Ÿæˆã•ã‚Œã‚‹ã®ã§ã€ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚¢ãƒ—ãƒªã‚’ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\n\n```sh\n// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•\ncd <ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå>\n\n// ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ\nyarn run serve\n```\n\n\n### 1-2. Firebaseå°å…¥\n- [Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«](https://firebase.google.com/?hl=ja)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€Firebaseã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ\n- Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã€Œæ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã€ã‹ã‚‰æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã™ã‚‹ã€‚\n- Firebaseã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n\n```sh\n//Firebaseã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n$ yarn global add firebase-tools\n\n// Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³\n$ firebase login\n\n// Firebaseã®è¨­å®š\n$ firebase init\n\n? Which Firebase CLI features do you want to setup for this folder? Press Space to select features, then Enter to confirm your choices.\n â—¯ Database: Deploy Firebase Realtime Database Rules\n â—‰ Firestore: Deploy rules and create indexes for Firestore\n â—‰ Functions: Configure and deploy Cloud Functions\n â—‰ Hosting: Configure and deploy Firebase Hosting sites\n â—¯ Storage: Deploy Cloud Storage security rules\n\n? Select a default Firebase project for this directory: (Use arrow keys)\nâ¯ document-paper-counter-81e10 (document-paper-counter) // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠ\n\n```\n\nFireStoreã®è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾\n\n```sh\n=== Firestore Setup\n\nFirestore Security Rules allow you to define how and when to allow\nrequests. You can keep these rules in your project directory\nand publish them with firebase deploy.\n\n? What file should be used for Firestore Rules? firestore.rules\n\n\nFirestore indexes allow you to perform complex queries while\nmaintaining performance that scales with the size of the result\nset. You can keep index definitions in your project directory\nand publish them with firebase deploy.\n\n? What file should be used for Firestore indexes? firestore.indexes.json\n\n\n=== Functions Setup\n\nA functions directory will be created in your project with a Node.js\npackage pre-configured. Functions can be deployed with firebase deploy.\n\n? What language would you like to use to write Cloud Functions? JavaScript\n? Do you want to use ESLint to catch probable bugs and enforce style? No\nâœ”  Wrote functions/package.json\nâœ”  Wrote functions/index.js\nâœ”  Wrote functions/.gitignore\n? Do you want to install dependencies with npm now? Yes\n```\n\nHostingã®è¨­å®šã¯ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š\n\n```sh\n=== Hosting Setup\n\nYour public directory is the folder (relative to your project directory) that\nwill contain Hosting assets to be uploaded with firebase deploy. If you\nhave a build process for your assets, use your build's output directory.\n\n? What do you want to use as your public directory? dist\n? Configure as a single-page app (rewrite all urls to /index.html)? Yes\n```\n\n\n- configæƒ…å ±ã‚’ç®¡ç†ç”»é¢ã‹ã‚‰å–å¾—(ä»Šå›ã¯Gitã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚ã’ã‚‹ãŸã‚ã«ç’°å¢ƒå¤‰æ•°ã«æ ¼ç´)\n- main.jsã§```firebase.initializeApp```ã‚’å®Ÿè¡Œ\n\n```javascript\n\nimport firebase from 'firebase/app'\n\n// initialize Firebase\nlet config = {\n  apiKey: process.env.VUE_APP_FIRE_BASE_apiKey,\n  authDomain: process.env.VUE_APP_FIRE_BASE_authDomain,\n  databaseURL: process.env.VUE_APP_FIRE_BASE_databaseURL,\n  projectId: process.env.VUE_APP_FIRE_BASE_projectId,\n  storageBucket: process.env.VUE_APP_FIRE_BASE_storageBucket,\n  messagingSenderId: process.env.VUE_APP_FIRE_BASE_messagingSenderId,\n  appId: process.env.VUE_APP_FIRE_BASE_appId\n}\n\nfirebase.initializeApp(config)\n...ç•¥\n```\nã“ã‚Œã§ã€Firebaseã®åˆæœŸè¨­å®šãŒã§ãã¾ã—ãŸã€‚\n\n### 1-3. ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ\n\nã“ã‚Œã‚‰ã®æ‰‹é †ã§ç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã‚’å…ƒã«ã€å¤§ã¾ã‹ã«ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã§ä½œæˆã—ã¾ã—ãŸã€‚\n\n<pre>\nâ”œâ”€â”€ dist\nâ”‚   â””â”€â”€ ãƒ“ãƒ«ãƒ‰å¾Œã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«\nâ”‚\nâ”œâ”€â”€ firebase.json\nâ”œâ”€â”€ firestore.indexes.json\nâ”œâ”€â”€ firestore.rules\nâ”œâ”€â”€ functions\nâ”‚   â”œâ”€â”€ index.js\nâ”‚   â”œâ”€â”€ package-lock.json\nâ”‚   â””â”€â”€ package.json\nâ”‚\nâ”œâ”€â”€ public\nâ”‚   â”œâ”€â”€ 404.html\nâ”‚   â”œâ”€â”€ favicon.ico\nâ”‚   â”œâ”€â”€ firebase-messaging-sw.js\nâ”‚   â”œâ”€â”€ img\nâ”‚   â”‚   â””â”€â”€ icons\nâ”‚   â”œâ”€â”€ index.html\nâ”‚   â”œâ”€â”€ manifest.json\nâ”‚   â””â”€â”€ robots.txt\nâ”œâ”€â”€ src\nâ”‚   â”œâ”€â”€ App.vue\nâ”‚   â”œâ”€â”€ main.js\nâ”‚   â”œâ”€â”€ registerServiceWorker.js\nâ”‚   â”œâ”€â”€ api\nâ”‚   â”‚   â””â”€â”€ firebase.js\nâ”‚   â”œâ”€â”€ assets\nâ”‚   â”‚   â””â”€â”€ scss\nâ”‚   â”‚       â””â”€â”€ entry.scss\nâ”‚   â”œâ”€â”€ components\nâ”‚   â”‚   â”œâ”€â”€ dialog.vue\nâ”‚   â”‚   â””â”€â”€ head-menu.vue\nâ”‚   â”œâ”€â”€ pages\nâ”‚   â”‚   â”œâ”€â”€ help.vue\nâ”‚   â”‚   â”œâ”€â”€ input.vue\nâ”‚   â”‚   â”œâ”€â”€ list.vue\nâ”‚   â”‚   â””â”€â”€ result.vue\nâ”‚   â”œâ”€â”€ router\nâ”‚   â”‚   â””â”€â”€ index.js\nâ”‚   â””â”€â”€ store\nâ”‚       â”œâ”€â”€ index.js\nâ”‚       â””â”€â”€ modules\nâ”‚           â”œâ”€â”€ auth.js\nâ”‚           â”œâ”€â”€ counter.js\nâ”‚           â””â”€â”€ list.js\nâ””â”€â”€ vue.config.js\n</pre>\n\n![vuex.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/538820/935f9faa-6bc9-0050-ba08-8c1b879c9bf0.png)\nå¼•ç”¨å…ƒ: https://vuex.vuejs.org/ja/\n\nä¸Šè¨˜ã®å›³ã®ã€```VueComponents```ã«å½“ãŸã‚‹éƒ¨åˆ†ãŒ```src/components```ã¨```src/pages```ã«ãªã‚Šã¾ã™ã€‚\n```vuex```ã«å½“ãŸã‚‹éƒ¨åˆ†ãŒ```store```å†…ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚\nä»Šå›ã®å ´åˆã€```BackendAPI```ã«å½“ãŸã‚‹éƒ¨åˆ†ãŒFirebaseã«ãªã‚‹ãŸã‚ã€Firebaseã«é–¢ã™ã‚‹é–¢æ•°ã‚’```src/api/firebase.js```ã«é›†ç´„ã—ã€```store```ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å‘¼ã³å‡ºã™æ–¹é‡ã§å®Ÿè£…ã—ã¾ã—ãŸã€‚\n\n## 2. Vueã§UIéƒ¨åˆ†ã‚’ä½œæˆ\nä»Šå›ã“ã“ã«ã¤ã„ã¦ã¯çœç•¥ã—ã¾ã™ã€‚\n\n\n\n## 3. Authentication(ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†)\nä»Šå›ã¯Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼ã§ãã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã—ãŸã€‚\n\n```javascript\n...ç•¥\n\nconst auth = firebase.auth()\n\nexport default {\n  initFirebase () {\n    auth.onAuthStateChanged(this.onAuthStateChanged.bind(this))\n  },\n\n  login () {\n    var provider = new firebase.auth.GoogleAuthProvider()\n    auth.signInWithPopup(provider)\n  },\n\n  logout () {\n    auth.signOut()\n  },\n\n  onAuthStateChanged (user) {\n    if (user) {\n     // ãƒ¦ãƒ¼ã‚¶ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹æ™‚ã®å‡¦ç†\n    } else {\n     // æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®å‡¦ç†\n    }\n  },\n\n...ç•¥\n```\n\n```main.js``` ã«ä»¥ä¸‹ã‚’è¿½åŠ \n\n```javascript\nimport Firebase from './api/firebase'\n\nFirebase.initFirebase()\n```\n\nã“ã®å‡¦ç†ã ã‘ã§Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®èªè¨¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚\n\n## 4. FireStore(ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)ã¸ã®æ›¸ãè¾¼ã¿\nä»¥å‰ä½¿ã‚ã‚Œã¦ã„ãŸFirebaseRealtimeDatabaseã§ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã‚’jsonãƒ•ã‚¡ã‚¤ãƒ«ã§è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€FireStoreã§ã¯æ›¸ãè¾¼ã¿ã®ãƒ«ãƒ¼ãƒ«ã®ã¿æŒ‡å®šã™ã‚Œã°ã€è‡ªç”±ã«ã‚«ãƒ©ãƒ ã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã§ã™ã€‚\n\n```javascript\n...ç•¥\nimport 'firebase/firestore'\nexport default {\n  //ä¾‹) åŸç¨¿ã®ãƒ‡ãƒ¼ã‚¿ã‚’firestoreã«ä¿å­˜ã™ã‚‹é–¢æ•°\n  saveDocument (document) {\n    return new Promise((resolve, reject) => {\n      const userId = VueCookies.get('userInfo').uid // cookieã«ä¿å­˜ã—ã¦ãŠã„ãŸãƒ¦ãƒ¼ã‚¶IDã‚’å–å¾—\n      database.collection('users').doc(userId).collection('documents')\n        .add(document)\n        .then((ref) =>  {\n          resolve(ref)\n        }).catch(reject)\n    })\n  },\n}\n```\n\n## 5. CloudMessagingã‚’åˆ©ç”¨ã—ãŸPushé€šçŸ¥\n\nâ€»Pushé€šçŸ¥ã«é–¢ã—ã¦ã¯Safariã‚„iOSç«¯æœ«ãªã©ã§ã¯éå¯¾å¿œã§ã™ã€‚iPhoneã§ã¯é€šçŸ¥ã‚’å‡ºã›ã¾ã›ã‚“ã€‚\n\n### 5-1. PWAåŒ–ã‚’ã—ã¦CloudMessagingã‚’å°å…¥ã™ã‚‹\n\nPWAåŒ–ã¨CloudMessagingã®å°å…¥ã«é–¢ã—ã¦ã¯ã€ä¸‹è¨˜è¨˜äº‹ã‚’å‚è€ƒã«å®Ÿè£…ã—ã¾ã—ãŸã€‚\n\n- [Vue CLI 3 ã§ PWA ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ï¼ˆService Workers / Add to Home Screen / Push Notificationsï¼‰](https://qiita.com/n11sh1/items/5d64c337ef927ac8d5d6#push-notifications)\n\n\næ³¨æ„ç‚¹ã¨ã—ã¦ã€\n\n```javascript\n... ç•¥\nlet messaging\n\nif(firebase.messaging.isSupported()) {\n  messaging = firebase.messaging()\n}\n\nexport default {\n  initFirebase () {\n    auth.onAuthStateChanged(this.onAuthStateChanged.bind(this))\n\n    if (firebase.messaging.isSupported()) {\n      messaging.usePublicVapidKey(process.env.VUE_APP_FIRE_BASE_publicVapidKey)\n      store.dispatch('auth/checkMessagingisSupported', true)\n    } else {\n      store.dispatch('auth/checkMessagingisSupported', false)\n    }\n  },\n...ç•¥\n```\n\nä¸Šè¨˜ã®ã‚ˆã†ã«```firebase.messaging.isSupported()```é–¢æ•°ã§CloudMessagingã«å¯¾å¿œã—ãŸç’°å¢ƒã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ãªã„ã¨\niOSç«¯æœ«ãªã©ã€CloudMessageingãŒéå¯¾å¿œã®ç’°å¢ƒã§ã¯ãƒšãƒ¼ã‚¸ãŒã¾ã£ã—ã‚ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚\n\n### 5-2. Pushé€šçŸ¥ã‚’ã™ã‚‹ãŸã‚ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã™ã‚‹\nè¤‡æ•°ã®ç«¯æœ«ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚ã€å…¨ã¦ã®ç«¯æœ«ã«pushé€šçŸ¥ãŒå±Šãã‚ˆã†ã«ã€è¤‡æ•°ç«¯æœ«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚\n\nå‚è€ƒãƒšãƒ¼ã‚¸\n- https://firebase.google.com/docs/cloud-messaging/js/device-group?hl=ja\n\nãƒˆãƒ¼ã‚¯ãƒ³è¿½åŠ ã®URLã‚’ãã®ã¾ã¾å©ãã¨ã€ã‚¯ãƒ­ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶ç´„ã«å¼•ã£ã‹ã‹ã£ã¦ã—ã¾ã†ãŸã‚ã€ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã—ã¾ã„ã¾ã™ã€‚\n\n```sh\nAccess-Control-Allow-Origin \n```\n\nãã“ã§ã€ãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®šã‚’ã—ã¾ã™ã€‚\n```vue.config.js```ã«ä¸‹è¨˜ã®è¨­å®šã‚’è¿½åŠ ã€‚\n\n```javascript\nmodule.exports = {\n    ...ç•¥\n    devServer: {\n        proxy: 'https://fcm.googleapis.com/',\n    }\n  }\n```\nã“ã‚Œã§ã€\n```<ã‚¢ãƒ—ãƒªãŒç«‹ã¡ä¸ŠãŒã£ã¦ã„ã‚‹ã‚µãƒ¼ãƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³>/hoge/some```\nã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã™ã¨ã€devserverã‚’çµŒç”±ã—ã¦\n```https://fcm.googleapis.com/hoge/some```\nã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\n\nå®Ÿéš›ã«ã¯ã€é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã§ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒé•ã†ã®ã§ã€ç’°å¢ƒå¤‰æ•°ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æ ¼ç´ã—ã¾ã™ã€‚\n\n\n.envãƒ•ã‚¡ã‚¤ãƒ«ã«æœ¬ç•ªç’°å¢ƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å¤‰æ•°ã§è¿½åŠ \n\n```javascript\nVUE_APP_API_URL_BASE=\"<ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å…ˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³>\"\n```\n\n.env.developãƒ•ã‚¡ã‚¤ãƒ«ã«ã€é–‹ç™ºç’°å¢ƒ(localhost)ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ \n\n```javascript\nVUE_APP_API_URL_BASE=\"http://localhost:8080\"\n```\n\nã“ã‚Œã§ã€ãƒ‰ãƒ¡ã‚¤ãƒ³éƒ¨åˆ†ã‚’å¤‰æ•°ã§æŒ‡å®šã™ã‚‹ã¨ã€é–‹ç™ºç’°å¢ƒã§ã‚‚ã€æœ¬ç•ªç’°å¢ƒã§ã‚‚ã€ã‚¯ãƒ­ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶ç´„ã«å¼•ã£ã‹ã‹ã‚‹ã“ã¨ãªããƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å©ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\n\n```javascript\n...ç•¥\n  // é€šçŸ¥ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—\n  getNotinotificationKey () {\n    const userId = VueCookies.get('userInfo').uid\n    const url = process.env.VUE_APP_API_URL_BASE + \"/fcm/notification?notification_key_name=\" + userId\n    let headers = {\n      'Content-Type':'application/json',\n      'Authorization': 'key=' + process.env.VUE_APP_FIRE_BASE_serverKey,\n      'project_id': process.env.VUE_APP_FIRE_BASE_messagingSenderId\n    }\n    return new Promise((resolve, reject) => {\n      axios.get(url, {headers: headers, data: {}})\n        .then(res => {\n          resolve(res.data)\n        }).catch(err => {\n          reject(err)\n        })\n    })\n  },\n...ç•¥\n```\n\n### 5-3. CloudFunctionsã§é€šçŸ¥ã‚’é€ã‚‹functionã‚’ä½œæˆ\n```functions/index.js``` ã«é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹functionã‚’ä½œæˆã—ã¦ã€deployã—ã¾ã™ã€‚\n\n```javascript\n\n// firestoreã«ã‹ã‚‰é€šçŸ¥å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ã¨ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—\nasync function getNotificationDocument () {\n  try {\n    // notificationListã«é€šçŸ¥ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´æ¸ˆã¿\n    const querySnapshot = await database.collection('notificationList').get()\n\n    return querySnapshot.docs.filter(doc => {\n      return moment().isSame(doc.data().deadline, 'day')\n    }).map(doc => {\n      return {\n        notificationKey: doc.data().notificationKey,\n        title: doc.data().title,\n        id: doc.id\n      }\n    })\n  } catch (error) {\n    throw error\n  }\n}\n\n// pushé€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹\nasync function DeadlineDocument(documents) {\n  const url = \"https://fcm.googleapis.com/fcm/send\"\n  const headers = {\n    'Authorization': 'key=' + functions.config().vue_app.server_key,\n  }\n\n  try{\n    for(let document of documents) {\n      let data = {\n        \"notification\": {\n          \"title\": \"ã€Œ\" + document.title + \"ã€ã¯ä»Šæ—¥ç· ã‚åˆ‡ã‚Šã§ã™\", //é€šçŸ¥ã®ã‚¿ã‚¤ãƒˆãƒ«\n          \"click_action\": \"result/\" + document.id //é€šçŸ¥ã‚’æŠ¼ã—ãŸæ™‚ã®é£›ã³å…ˆ\n        },\n        \"to\": document.notificationKey //ãƒˆãƒ¼ã‚¯ãƒ³\n      }\n\n      axios.post(url, data, {headers: headers, useCredentails: true})\n\n      await sleep(2000)\n    }\n\n    return documents\n  } catch (error) {\n    throw error.response.status\n  }\n}\n\n// ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹é–¢æ•°\nexports.pushNotification = functions.https.onRequest(async (request, response) => {\n  try{\n    const res = await getNotificationDocument()\n    const today = await pushNotificationTodaysDeadlineDocument(res.today)\n    response.send(today)\n  } catch (error) {\n    response.status(500).send(error)\n  }\n})\n```\n\nä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§functionã‚’ãƒ‡ãƒ—ãƒ­ã‚¤\n\n```sh\n$ firebase deploy --only functions\n\nFunction URL (addMessage): https://MY_PROJECT.cloudfunctions.net/pushNotification\n```\n\nFunctionURLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ã€pushé€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã‚Œã°æˆåŠŸã§ã™â—\n\n### 5-4. Cronã§é–¢æ•°ã‚’å®šæœŸå®Ÿè¡Œ\nFirebaseã®ã¿ã§å®šæœŸå®Ÿè¡Œã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€èª²é‡‘ãŒå¿…è¦ã§ã™ã€‚\nhttps://firebase.google.com/docs/functions/schedule-functions\n\nä»Šå›ã¯ã€ç„¡æ–™ã§å®Ÿè£…ã—ãŸã‹ã£ãŸãŸã‚ã€å¤–éƒ¨ã®Cronã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚\n\n- [cron-job.org](https://cron-job.org/en/)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€TOPç”»é¢ã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹\n- ã€ŒCronjobsã€ã‚¿ãƒ–ã®ã€Œ+Create cronjobã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€æ–°è¦jobã‚’ä½œæˆ\n- titleã¨FunctionURLã€ä»»æ„ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®šã—ã€jobã‚’ä½œæˆ\n\nã“ã‚Œã§è¨­å®šãŒã†ã¾ãã„ã£ã¦ã„ã‚Œã°ã€è¨­å®šã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§é€šçŸ¥ã•ã‚Œã¾ã™ğŸ‰\n\n## æ„Ÿæƒ³\nCloudMessagingã¯åˆã‚ã¦åˆ©ç”¨ã—ã¾ã—ãŸãŒã€æƒ³åƒä»¥ä¸Šã«ç°¡å˜ã«pushé€šçŸ¥ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚\nPWAåŒ–ã‚‚VueCLIã‚’åˆ©ç”¨ã™ã‚Œã°ã€æ‰‹é–“ç„¡ãå®Ÿè£…ã§ãã¾ã—ãŸã€‚\n\nPWAã¯iOSã®å¯¾å¿œçŠ¶æ³ãŒèŠ³ã—ããªã„ã®ã§ã€ä»Šå¾Œã«æœŸå¾…ã§ã™ã€‚ã€‚ã€‚ğŸ˜”\n\nåŸç¨¿ç”¨ç´™ã®è¡¨ç¤ºéƒ¨åˆ†ã¯æ€ã„ã¤ãã¨ãƒã‚«ãƒ©ãƒ¯ã‚¶ã§å®Ÿè£…ã—ãŸã®ã§ã€ãƒã‚°ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚ã€‚\nä¸å…·åˆãªã©è¦‹ã¤ã‘ãŸã‚‰ã”æŒ‡æ‘˜ã„ãŸã ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™m(_ _)m",
  "bodyHtml": "<p>ã“ã®è¨˜äº‹ã¯<a href=\"https://qiita.com/advent-calendar/2019/northdetail\">North Detail Advent Calendar 2019</a>17æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚</p>\n<p><em>â€»èª¬æ˜ã®ãŸã‚ã«ã„ãã¤ã‹ã‚³ãƒ¼ãƒ‰ã‚’è¼‰ã›ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã«ä½œæˆã—ãŸã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰(Github)ã¨ã¯ä¼¼ã¦ç•°ãªã‚Šã¾ã™ã€‚</em></p>\n<h2>æ¦‚è¦</h2>\n<p>å­¦ç”Ÿæ™‚ä»£ã«æ‰‹æ›¸ããƒ¬ãƒãƒ¼ãƒˆã®ä¸‹æ›¸ãã‚’PCã§æ‰“ã¡è¾¼ã‚“ã§ã„ãŸã®ã§ã™ãŒã€å®Ÿéš›ã«ãƒã‚¹ç›®ã«å½“ã¦ã¯ã‚ã‚‹ã¨æ®µè½ã®åˆ‡ã‚Šæ›¿ãˆã‚„ã€æ•°å­—ã‚’1ãƒã‚¹ã«2ã¤å…¥ã‚Œã‚‹...etcãªã©ã®ãƒ«ãƒ¼ãƒ«ãŒã‚ã£ãŸã‚Šã—ã¦ã€æ–‡å­—æ•°ï¼ãƒã‚¹ç›®ã®æ•°ã«ãªã‚‰ãªã„ã®ã§ã€PCã§ä¸‹æ›¸ãã‚’ã—ã¦æ–‡å­—æ•°ã‚’åŸç¨¿ç”¨ç´™ã«ã‚ã‚ã›ã¦ã‚‚ã€çµå±€æ–‡ç« ã®é•·ã•ãŒå¤šã™ããŸã‚Šã€é€†ã«è¶³ã‚Šãªã‹ã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒå¤šã€…ã‚ã‚Šã¾ã—ãŸã€‚\nã¨ã„ã†ã“ã¨ã§ã€æ‰“ã¡è¾¼ã‚“ã æ–‡ç« ã‚’åŸç¨¿ç”¨ç´™ã«å½“ã¦ã¯ã‚ãŸã‚ˆã†ã«ã—ã¦è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚</p>\n<h2>ä½œã£ãŸã‚‚ã®</h2>\n<ul>\n<li>å…¥åŠ›ã—ãŸæ–‡ç« ãŒåŸç¨¿ç”¨ç´™ã«åã¾ã‚‹ã‹ã©ã†ã‹ã‚’ã€å®Ÿéš›ã«ãƒã‚¹ç›®ã«ç´ã‚ã¦ã‚«ã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚</li>\n<li>ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ã‚«ã‚¦ãƒ³ãƒˆã—ãŸçµæœã‚’ä¿å­˜ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</li>\n<li>ç· åˆ‡æ—¥ã‚’è¨­å®šã™ã‚‹ã¨ç· ã‚åˆ‡ã‚Šå‰æ—¥ã¨å½“æ—¥ã«Pushé€šçŸ¥ãŒå±Šãã¾ã™ã€‚(8:00ã¨17:00ã«é€šçŸ¥)</li>\n</ul>\n<p><img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/538820/de3542d5-7b5f-635e-3c38-5d11d3c3e53b.png\" alt=\"ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-12-04 19.01.40ï¼ˆ2ï¼‰.png\">\n<img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/538820/a9ae857f-336a-5aa3-bd04-ccbe8f39dda3.png\" alt=\"ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ 2019-12-04 19.02.23ï¼ˆ2ï¼‰.png\"></p>\n<p>æ–‡å­—æ•°ã‚ªãƒ¼ãƒãƒ¼ã—ãŸç®‡æ‰€ã¯èµ¤ã„ãƒã‚¹ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\nã€Œæ®µè½ã®é ­ã‚’1ãƒã‚¹é–‹ã‘ã‚‹ã€ã€ã€Œæ‹¬å¼§ã‚’ä»–ã®æ–‡å­—ã¨åŒã˜ã¾ã™ã«å…¥ã‚Œã‚‹ã€ãªã©ã€å®Ÿéš›ã®åŸç¨¿ç”¨ç´™ã®ãƒ«ãƒ¼ãƒ«ã«å‰‡ã£ãŸæ›¸å¼è¨­å®šãŒã§ãã‚‹ã®ã§ã€æ‰“ã£ãŸæ–‡ç« ãŒåŸç¨¿ç”¨ç´™ä½•æšåˆ†ã«åã¾ã‚‹ã®ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>\n<ul>\n<li><a href=\"https://document-paper-counter-81e10.firebaseapp.com/\">Demo</a></li>\n<li><a href=\"https://github.com/shunsato1231/document-paper-counter\">Git</a></li>\n</ul>\n<h2>å®Ÿè£…ã—ãŸæ©Ÿèƒ½ã¨ã€å®Ÿè£…å†…å®¹ã®æ¦‚è¦</h2>\n<h3>æ–‡å­—ã®ã‚«ã‚¦ãƒ³ãƒˆ</h3>\n<ol>\n<li>å…¥åŠ›ã—ãŸæœ¬æ–‡ã¨ã€åŸç¨¿ç”¨ç´™ã®æ›¸å¼è¨­å®šã‚’Vuex Storeã«æ ¼ç´</li>\n<li>Vuexã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å…¥åŠ›ã—ãŸæ–‡å­—ã‚’é…åˆ—ã«åˆ†å‰²ã—ã€(é…åˆ—1ã¤ã«åŸç¨¿ç”¨ç´™ã²ã¨ã¾ã™åˆ†ã®æ–‡å­—ã‚’æ ¼ç´)Vuex Storeã«æ ¼ç´</li>\n<li>é…åˆ—ã«æ ¼ç´ã•ã‚ŒãŸæ–‡å­—ã‚’åŸç¨¿ç”¨ç´™é¢¨ã«è¡¨ç¤º</li>\n</ol>\n<h3>ã‚«ã‚¦ãƒ³ãƒˆã—ãŸæ–‡ç« ã®ä¿å­˜</h3>\n<p>å…¥åŠ›ã—ãŸæ–‡ç« ã¨ã€åŸç¨¿ç”¨ç´™ã®æ›¸å¼è¨­å®šã‚’FireStoreã«ã¦ç®¡ç†ã€‚</p>\n<h3>é€šçŸ¥å‡¦ç†</h3>\n<ol>\n<li>åŸç¨¿ç”¨ç´™é¢¨ã«è¡¨ç¤ºã™ã‚‹ç”»é¢ã§ã€ã€Œé€šçŸ¥ã™ã‚‹ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’æŠ¼ã—ãŸæ™‚ã«é€šçŸ¥ç”¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—</li>\n<li>ä¿å­˜æ™‚ã«ã€é€šçŸ¥ç”¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜</li>\n<li>FirebaseFunctionsã§pushé€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹é–¢æ•°ã‚’ä½œæˆ</li>\n<li>å¤–éƒ¨ã®Cronã‚’åˆ©ç”¨ã—ã¦ã€æ¯æ—¥8:00ã¨17:00ã«FirebaseFunctionsã§ä½œæˆã—ãŸpushé€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹é–¢æ•°ã‚’å®Ÿè¡Œ</li>\n</ol>\n<h2>å®Ÿè£…ã®æ‰‹é †</h2>\n<p>å¤§ã¾ã‹ã«ã§ã™ãŒã€å®Ÿè£…ã®æ‰‹é †ã«ã¤ã„ã¦ç´¹ä»‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚</p>\n<h2>1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ</h2>\n<p>yarnãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å‰æã§ã™ã€‚</p>\n<h3>1-1. Vue Cliã‚’ä½¿ã£ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h3>\n<pre><code class=\"hljs\">// vueCLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\nyarn global add @vue/cli\n\n// æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ\nvue create &lt;ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå&gt;</code></pre><p>ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã€‚</p>\n<p>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä½¿ã†ã‹ã€æ‰‹å‹•ã§é¸æŠã™ã‚‹ã‹ã‚’èã‹ã‚Œã‚‹ã®ã§ <code>Manually select features</code> ã‚’é¸æŠã€‚</p>\n<pre><code class=\"hljs\">? Please pick a preset: \n  default (babel, eslint) \nâ¯ Manually select features</code></pre><p>ç¶šãè¨­å•ã‚‚ä¸‹è¨˜ã®ã‚ˆã†ã«é¸æŠã€‚</p>\n<pre><code class=\"hljs\">? Check the features needed <span class=\"hljs-keyword\">for</span> your project: \nâ¯ â—‰ Babel\n  â—¯ TypeScript\nâ¯ â—‰ Progressive Web App (PWA) Support\nâ¯ â—‰ Router\nâ¯ â—‰ Vuex\nâ¯ â—‰ CSS Pre-processors\nâ¯ â—‰ Linter / Formatter\n  â—¯ Unit Testing\n  â—¯ E2E Testing\n\n? Use <span class=\"hljs-built_in\">history</span> mode <span class=\"hljs-keyword\">for</span> router? (Requires proper server setup <span class=\"hljs-keyword\">for</span> index fallback <span class=\"hljs-keyword\">in</span> production)\nâ¯ Yes\n\n? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default)\nâ¯ Scss\n\n? Pick a linter / formatter config\nâ¯ ESLint with error prevention only \n\n? Pick additional lint features: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)\nâ¯ Lint on save\n\n? Where <span class=\"hljs-keyword\">do</span> you prefer placing config <span class=\"hljs-keyword\">for</span> Babel, PostCSS, ESLint, etc.? \nâ¯ In dedicated config files</code></pre><p>ã“ã‚Œã§Vueãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é››å½¢ãŒç”Ÿæˆã•ã‚Œã‚‹ã®ã§ã€ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã‚¢ãƒ—ãƒªã‚’ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p>\n<pre><code class=\"hljs\">// ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•\n<span class=\"hljs-built_in\">cd</span> &lt;ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå&gt;\n\n// ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œ\nyarn run serve</code></pre><h3>1-2. Firebaseå°å…¥</h3>\n<ul>\n<li><a href=\"https://firebase.google.com/?hl=ja\">Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«</a>ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€Firebaseã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ</li>\n<li>Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã€Œæ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã€ã‹ã‚‰æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã™ã‚‹ã€‚</li>\n<li>Firebaseã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</li>\n</ul>\n<pre><code class=\"hljs\">//Firebaseã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n$ yarn global add firebase-tools\n\n// Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³\n$ firebase login\n\n// Firebaseã®è¨­å®š\n$ firebase init\n\n? Which Firebase CLI features <span class=\"hljs-keyword\">do</span> you want to setup <span class=\"hljs-keyword\">for</span> this folder? Press Space to select features, <span class=\"hljs-keyword\">then</span> Enter to confirm your choices.\n â—¯ Database: Deploy Firebase Realtime Database Rules\n â—‰ Firestore: Deploy rules and create indexes <span class=\"hljs-keyword\">for</span> Firestore\n â—‰ Functions: Configure and deploy Cloud Functions\n â—‰ Hosting: Configure and deploy Firebase Hosting sites\n â—¯ Storage: Deploy Cloud Storage security rules\n\n? Select a default Firebase project <span class=\"hljs-keyword\">for</span> this directory: (Use arrow keys)\nâ¯ document-paper-counter-81e10 (document-paper-counter) // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠ</code></pre><p>FireStoreã®è¨­å®šã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾</p>\n<pre><code class=\"hljs\">=== Firestore Setup\n\nFirestore Security Rules allow you to define how and when to allow\nrequests. You can keep these rules <span class=\"hljs-keyword\">in</span> your project directory\nand publish them with firebase deploy.\n\n? What file should be used <span class=\"hljs-keyword\">for</span> Firestore Rules? firestore.rules\n\n\nFirestore indexes allow you to perform complex queries <span class=\"hljs-keyword\">while</span>\nmaintaining performance that scales with the size of the result\n<span class=\"hljs-built_in\">set</span>. You can keep index definitions <span class=\"hljs-keyword\">in</span> your project directory\nand publish them with firebase deploy.\n\n? What file should be used <span class=\"hljs-keyword\">for</span> Firestore indexes? firestore.indexes.json\n\n\n=== Functions Setup\n\nA <span class=\"hljs-built_in\">functions</span> directory will be created <span class=\"hljs-keyword\">in</span> your project with a Node.js\npackage pre-configured. Functions can be deployed with firebase deploy.\n\n? What language would you like to use to write Cloud Functions? JavaScript\n? Do you want to use ESLint to catch probable bugs and enforce style? No\nâœ”  Wrote <span class=\"hljs-built_in\">functions</span>/package.json\nâœ”  Wrote <span class=\"hljs-built_in\">functions</span>/index.js\nâœ”  Wrote <span class=\"hljs-built_in\">functions</span>/.gitignore\n? Do you want to install dependencies with npm now? Yes</code></pre><p>Hostingã®è¨­å®šã¯ä¸‹è¨˜ã®ã‚ˆã†ã«è¨­å®š</p>\n<pre><code class=\"hljs\">=== Hosting Setup\n\nYour public directory is the folder (relative to your project directory) that\nwill contain Hosting assets to be uploaded with firebase deploy. If you\nhave a build process for your assets, use your build's output directory.\n\n? What do you want to use as your public directory? dist\n? Configure as a single-page app (rewrite all urls to /index.html)? Yes</code></pre><ul>\n<li>configæƒ…å ±ã‚’ç®¡ç†ç”»é¢ã‹ã‚‰å–å¾—(ä»Šå›ã¯Gitã«ã‚³ãƒ¼ãƒ‰ã‚’ã‚ã’ã‚‹ãŸã‚ã«ç’°å¢ƒå¤‰æ•°ã«æ ¼ç´)</li>\n<li>main.jsã§<code>firebase.initializeApp</code>ã‚’å®Ÿè¡Œ</li>\n</ul>\n<pre><code class=\"hljs\"><span class=\"hljs-keyword\">import</span> firebase <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'firebase/app'</span>\n\n<span class=\"hljs-comment\">// initialize Firebase</span>\n<span class=\"hljs-keyword\">let</span> config = {\n  <span class=\"hljs-attr\">apiKey</span>: process.env.VUE_APP_FIRE_BASE_apiKey,\n  <span class=\"hljs-attr\">authDomain</span>: process.env.VUE_APP_FIRE_BASE_authDomain,\n  <span class=\"hljs-attr\">databaseURL</span>: process.env.VUE_APP_FIRE_BASE_databaseURL,\n  <span class=\"hljs-attr\">projectId</span>: process.env.VUE_APP_FIRE_BASE_projectId,\n  <span class=\"hljs-attr\">storageBucket</span>: process.env.VUE_APP_FIRE_BASE_storageBucket,\n  <span class=\"hljs-attr\">messagingSenderId</span>: process.env.VUE_APP_FIRE_BASE_messagingSenderId,\n  <span class=\"hljs-attr\">appId</span>: process.env.VUE_APP_FIRE_BASE_appId\n}\n\nfirebase.initializeApp(config)\n...ç•¥</code></pre><p>ã“ã‚Œã§ã€Firebaseã®åˆæœŸè¨­å®šãŒã§ãã¾ã—ãŸã€‚</p>\n<h3>1-3. ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ</h3>\n<p>ã“ã‚Œã‚‰ã®æ‰‹é †ã§ç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã‚’å…ƒã«ã€å¤§ã¾ã‹ã«ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã§ä½œæˆã—ã¾ã—ãŸã€‚</p>\n<p>&lt;pre&gt;\nâ”œâ”€â”€ dist\nâ”‚   â””â”€â”€ ãƒ“ãƒ«ãƒ‰å¾Œã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«\nâ”‚\nâ”œâ”€â”€ firebase.json\nâ”œâ”€â”€ firestore.indexes.json\nâ”œâ”€â”€ firestore.rules\nâ”œâ”€â”€ functions\nâ”‚   â”œâ”€â”€ index.js\nâ”‚   â”œâ”€â”€ package-lock.json\nâ”‚   â””â”€â”€ package.json\nâ”‚\nâ”œâ”€â”€ public\nâ”‚   â”œâ”€â”€ 404.html\nâ”‚   â”œâ”€â”€ favicon.ico\nâ”‚   â”œâ”€â”€ firebase-messaging-sw.js\nâ”‚   â”œâ”€â”€ img\nâ”‚   â”‚   â””â”€â”€ icons\nâ”‚   â”œâ”€â”€ index.html\nâ”‚   â”œâ”€â”€ manifest.json\nâ”‚   â””â”€â”€ robots.txt\nâ”œâ”€â”€ src\nâ”‚   â”œâ”€â”€ App.vue\nâ”‚   â”œâ”€â”€ main.js\nâ”‚   â”œâ”€â”€ registerServiceWorker.js\nâ”‚   â”œâ”€â”€ api\nâ”‚   â”‚   â””â”€â”€ firebase.js\nâ”‚   â”œâ”€â”€ assets\nâ”‚   â”‚   â””â”€â”€ scss\nâ”‚   â”‚       â””â”€â”€ entry.scss\nâ”‚   â”œâ”€â”€ components\nâ”‚   â”‚   â”œâ”€â”€ dialog.vue\nâ”‚   â”‚   â””â”€â”€ head-menu.vue\nâ”‚   â”œâ”€â”€ pages\nâ”‚   â”‚   â”œâ”€â”€ help.vue\nâ”‚   â”‚   â”œâ”€â”€ input.vue\nâ”‚   â”‚   â”œâ”€â”€ list.vue\nâ”‚   â”‚   â””â”€â”€ result.vue\nâ”‚   â”œâ”€â”€ router\nâ”‚   â”‚   â””â”€â”€ index.js\nâ”‚   â””â”€â”€ store\nâ”‚       â”œâ”€â”€ index.js\nâ”‚       â””â”€â”€ modules\nâ”‚           â”œâ”€â”€ auth.js\nâ”‚           â”œâ”€â”€ counter.js\nâ”‚           â””â”€â”€ list.js\nâ””â”€â”€ vue.config.js\n&lt;/pre&gt;</p>\n<p><img src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/538820/935f9faa-6bc9-0050-ba08-8c1b879c9bf0.png\" alt=\"vuex.png\">\nå¼•ç”¨å…ƒ: https://vuex.vuejs.org/ja/</p>\n<p>ä¸Šè¨˜ã®å›³ã®ã€<code>VueComponents</code>ã«å½“ãŸã‚‹éƒ¨åˆ†ãŒ<code>src/components</code>ã¨<code>src/pages</code>ã«ãªã‚Šã¾ã™ã€‚\n<code>vuex</code>ã«å½“ãŸã‚‹éƒ¨åˆ†ãŒ<code>store</code>å†…ã«æ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚\nä»Šå›ã®å ´åˆã€<code>BackendAPI</code>ã«å½“ãŸã‚‹éƒ¨åˆ†ãŒFirebaseã«ãªã‚‹ãŸã‚ã€Firebaseã«é–¢ã™ã‚‹é–¢æ•°ã‚’<code>src/api/firebase.js</code>ã«é›†ç´„ã—ã€<code>store</code>ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å‘¼ã³å‡ºã™æ–¹é‡ã§å®Ÿè£…ã—ã¾ã—ãŸã€‚</p>\n<h2>2. Vueã§UIéƒ¨åˆ†ã‚’ä½œæˆ</h2>\n<p>ä»Šå›ã“ã“ã«ã¤ã„ã¦ã¯çœç•¥ã—ã¾ã™ã€‚</p>\n<h2>3. Authentication(ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†)</h2>\n<p>ä»Šå›ã¯Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼ã§ãã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã—ãŸã€‚</p>\n<pre><code class=\"hljs\">...ç•¥\n\n<span class=\"hljs-keyword\">const</span> auth = firebase.auth()\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> {\n  initFirebase () {\n    auth.onAuthStateChanged(<span class=\"hljs-keyword\">this</span>.onAuthStateChanged.bind(<span class=\"hljs-keyword\">this</span>))\n  },\n\n  login () {\n    <span class=\"hljs-keyword\">var</span> provider = <span class=\"hljs-keyword\">new</span> firebase.auth.GoogleAuthProvider()\n    auth.signInWithPopup(provider)\n  },\n\n  logout () {\n    auth.signOut()\n  },\n\n  onAuthStateChanged (user) {\n    <span class=\"hljs-keyword\">if</span> (user) {\n     <span class=\"hljs-comment\">// ãƒ¦ãƒ¼ã‚¶ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹æ™‚ã®å‡¦ç†</span>\n    } <span class=\"hljs-keyword\">else</span> {\n     <span class=\"hljs-comment\">// æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®å‡¦ç†</span>\n    }\n  },\n\n...ç•¥</code></pre><p><code>main.js</code> ã«ä»¥ä¸‹ã‚’è¿½åŠ </p>\n<pre><code class=\"hljs\"><span class=\"hljs-keyword\">import</span> Firebase <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./api/firebase'</span>\n\nFirebase.initFirebase()</code></pre><p>ã“ã®å‡¦ç†ã ã‘ã§Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®èªè¨¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>\n<h2>4. FireStore(ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)ã¸ã®æ›¸ãè¾¼ã¿</h2>\n<p>ä»¥å‰ä½¿ã‚ã‚Œã¦ã„ãŸFirebaseRealtimeDatabaseã§ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã‚’jsonãƒ•ã‚¡ã‚¤ãƒ«ã§è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸãŒã€FireStoreã§ã¯æ›¸ãè¾¼ã¿ã®ãƒ«ãƒ¼ãƒ«ã®ã¿æŒ‡å®šã™ã‚Œã°ã€è‡ªç”±ã«ã‚«ãƒ©ãƒ ã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã§ã™ã€‚</p>\n<pre><code class=\"hljs\">...ç•¥\n<span class=\"hljs-keyword\">import</span> <span class=\"hljs-string\">'firebase/firestore'</span>\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> {\n  <span class=\"hljs-comment\">//ä¾‹) åŸç¨¿ã®ãƒ‡ãƒ¼ã‚¿ã‚’firestoreã«ä¿å­˜ã™ã‚‹é–¢æ•°</span>\n  saveDocument (<span class=\"hljs-built_in\">document</span>) {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {\n      <span class=\"hljs-keyword\">const</span> userId = VueCookies.get(<span class=\"hljs-string\">'userInfo'</span>).uid <span class=\"hljs-comment\">// cookieã«ä¿å­˜ã—ã¦ãŠã„ãŸãƒ¦ãƒ¼ã‚¶IDã‚’å–å¾—</span>\n      database.collection(<span class=\"hljs-string\">'users'</span>).doc(userId).collection(<span class=\"hljs-string\">'documents'</span>)\n        .add(<span class=\"hljs-built_in\">document</span>)\n        .then(<span class=\"hljs-function\">(<span class=\"hljs-params\">ref</span>) =&gt;</span>  {\n          resolve(ref)\n        }).catch(reject)\n    })\n  },\n}</code></pre><h2>5. CloudMessagingã‚’åˆ©ç”¨ã—ãŸPushé€šçŸ¥</h2>\n<p>â€»Pushé€šçŸ¥ã«é–¢ã—ã¦ã¯Safariã‚„iOSç«¯æœ«ãªã©ã§ã¯éå¯¾å¿œã§ã™ã€‚iPhoneã§ã¯é€šçŸ¥ã‚’å‡ºã›ã¾ã›ã‚“ã€‚</p>\n<h3>5-1. PWAåŒ–ã‚’ã—ã¦CloudMessagingã‚’å°å…¥ã™ã‚‹</h3>\n<p>PWAåŒ–ã¨CloudMessagingã®å°å…¥ã«é–¢ã—ã¦ã¯ã€ä¸‹è¨˜è¨˜äº‹ã‚’å‚è€ƒã«å®Ÿè£…ã—ã¾ã—ãŸã€‚</p>\n<ul>\n<li><a href=\"https://qiita.com/n11sh1/items/5d64c337ef927ac8d5d6#push-notifications\">Vue CLI 3 ã§ PWA ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ï¼ˆService Workers / Add to Home Screen / Push Notificationsï¼‰</a></li>\n</ul>\n<p>æ³¨æ„ç‚¹ã¨ã—ã¦ã€</p>\n<pre><code class=\"hljs\">... ç•¥\n<span class=\"hljs-keyword\">let</span> messaging\n\n<span class=\"hljs-keyword\">if</span>(firebase.messaging.isSupported()) {\n  messaging = firebase.messaging()\n}\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> {\n  initFirebase () {\n    auth.onAuthStateChanged(<span class=\"hljs-keyword\">this</span>.onAuthStateChanged.bind(<span class=\"hljs-keyword\">this</span>))\n\n    <span class=\"hljs-keyword\">if</span> (firebase.messaging.isSupported()) {\n      messaging.usePublicVapidKey(process.env.VUE_APP_FIRE_BASE_publicVapidKey)\n      store.dispatch(<span class=\"hljs-string\">'auth/checkMessagingisSupported'</span>, <span class=\"hljs-literal\">true</span>)\n    } <span class=\"hljs-keyword\">else</span> {\n      store.dispatch(<span class=\"hljs-string\">'auth/checkMessagingisSupported'</span>, <span class=\"hljs-literal\">false</span>)\n    }\n  },\n...ç•¥</code></pre><p>ä¸Šè¨˜ã®ã‚ˆã†ã«<code>firebase.messaging.isSupported()</code>é–¢æ•°ã§CloudMessagingã«å¯¾å¿œã—ãŸç’°å¢ƒã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ãªã„ã¨\niOSç«¯æœ«ãªã©ã€CloudMessageingãŒéå¯¾å¿œã®ç’°å¢ƒã§ã¯ãƒšãƒ¼ã‚¸ãŒã¾ã£ã—ã‚ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚</p>\n<h3>5-2. Pushé€šçŸ¥ã‚’ã™ã‚‹ãŸã‚ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã™ã‚‹</h3>\n<p>è¤‡æ•°ã®ç«¯æœ«ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‚ã€å…¨ã¦ã®ç«¯æœ«ã«pushé€šçŸ¥ãŒå±Šãã‚ˆã†ã«ã€è¤‡æ•°ç«¯æœ«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚</p>\n<p>å‚è€ƒãƒšãƒ¼ã‚¸</p>\n<ul>\n<li>https://firebase.google.com/docs/cloud-messaging/js/device-group?hl=ja</li>\n</ul>\n<p>ãƒˆãƒ¼ã‚¯ãƒ³è¿½åŠ ã®URLã‚’ãã®ã¾ã¾å©ãã¨ã€ã‚¯ãƒ­ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶ç´„ã«å¼•ã£ã‹ã‹ã£ã¦ã—ã¾ã†ãŸã‚ã€ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã—ã¾ã„ã¾ã™ã€‚</p>\n<pre><code class=\"hljs\">Access-Control-Allow-Origin</code></pre><p>ãã“ã§ã€ãƒ—ãƒ­ã‚­ã‚·ã®è¨­å®šã‚’ã—ã¾ã™ã€‚\n<code>vue.config.js</code>ã«ä¸‹è¨˜ã®è¨­å®šã‚’è¿½åŠ ã€‚</p>\n<pre><code class=\"hljs\"><span class=\"hljs-built_in\">module</span>.exports = {\n    ...ç•¥\n    <span class=\"hljs-attr\">devServer</span>: {\n        <span class=\"hljs-attr\">proxy</span>: <span class=\"hljs-string\">'https://fcm.googleapis.com/'</span>,\n    }\n  }</code></pre><p>ã“ã‚Œã§ã€\n<code>&lt;ã‚¢ãƒ—ãƒªãŒç«‹ã¡ä¸ŠãŒã£ã¦ã„ã‚‹ã‚µãƒ¼ãƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³&gt;/hoge/some</code>\nã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã™ã¨ã€devserverã‚’çµŒç”±ã—ã¦\n<code>https://fcm.googleapis.com/hoge/some</code>\nã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>\n<p>å®Ÿéš›ã«ã¯ã€é–‹ç™ºç’°å¢ƒã¨æœ¬ç•ªç’°å¢ƒã§ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒé•ã†ã®ã§ã€ç’°å¢ƒå¤‰æ•°ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æ ¼ç´ã—ã¾ã™ã€‚</p>\n<p>.envãƒ•ã‚¡ã‚¤ãƒ«ã«æœ¬ç•ªç’°å¢ƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å¤‰æ•°ã§è¿½åŠ </p>\n<pre><code class=\"hljs\">VUE_APP_API_URL_BASE=<span class=\"hljs-string\">\"&lt;ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å…ˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³&gt;\"</span></code></pre><p>.env.developãƒ•ã‚¡ã‚¤ãƒ«ã«ã€é–‹ç™ºç’°å¢ƒ(localhost)ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ </p>\n<pre><code class=\"hljs\">VUE_APP_API_URL_BASE=<span class=\"hljs-string\">\"http://localhost:8080\"</span></code></pre><p>ã“ã‚Œã§ã€ãƒ‰ãƒ¡ã‚¤ãƒ³éƒ¨åˆ†ã‚’å¤‰æ•°ã§æŒ‡å®šã™ã‚‹ã¨ã€é–‹ç™ºç’°å¢ƒã§ã‚‚ã€æœ¬ç•ªç’°å¢ƒã§ã‚‚ã€ã‚¯ãƒ­ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¶ç´„ã«å¼•ã£ã‹ã‹ã‚‹ã“ã¨ãªããƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å©ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚</p>\n<pre><code class=\"hljs\">...ç•¥\n  <span class=\"hljs-comment\">// é€šçŸ¥ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—</span>\n  getNotinotificationKey () {\n    <span class=\"hljs-keyword\">const</span> userId = VueCookies.get(<span class=\"hljs-string\">'userInfo'</span>).uid\n    <span class=\"hljs-keyword\">const</span> url = process.env.VUE_APP_API_URL_BASE + <span class=\"hljs-string\">\"/fcm/notification?notification_key_name=\"</span> + userId\n    <span class=\"hljs-keyword\">let</span> headers = {\n      <span class=\"hljs-string\">'Content-Type'</span>:<span class=\"hljs-string\">'application/json'</span>,\n      <span class=\"hljs-string\">'Authorization'</span>: <span class=\"hljs-string\">'key='</span> + process.env.VUE_APP_FIRE_BASE_serverKey,\n      <span class=\"hljs-string\">'project_id'</span>: process.env.VUE_APP_FIRE_BASE_messagingSenderId\n    }\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {\n      axios.get(url, {<span class=\"hljs-attr\">headers</span>: headers, <span class=\"hljs-attr\">data</span>: {}})\n        .then(<span class=\"hljs-function\"><span class=\"hljs-params\">res</span> =&gt;</span> {\n          resolve(res.data)\n        }).catch(<span class=\"hljs-function\"><span class=\"hljs-params\">err</span> =&gt;</span> {\n          reject(err)\n        })\n    })\n  },\n...ç•¥</code></pre><h3>5-3. CloudFunctionsã§é€šçŸ¥ã‚’é€ã‚‹functionã‚’ä½œæˆ</h3>\n<p><code>functions/index.js</code> ã«é€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹functionã‚’ä½œæˆã—ã¦ã€deployã—ã¾ã™ã€‚</p>\n<pre><code class=\"hljs\"><span class=\"hljs-comment\">// firestoreã«ã‹ã‚‰é€šçŸ¥å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ã¨ã€ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getNotificationDocument</span> (<span class=\"hljs-params\"></span>) </span>{\n  <span class=\"hljs-keyword\">try</span> {\n    <span class=\"hljs-comment\">// notificationListã«é€šçŸ¥ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´æ¸ˆã¿</span>\n    <span class=\"hljs-keyword\">const</span> querySnapshot = <span class=\"hljs-keyword\">await</span> database.collection(<span class=\"hljs-string\">'notificationList'</span>).get()\n\n    <span class=\"hljs-keyword\">return</span> querySnapshot.docs.filter(<span class=\"hljs-function\"><span class=\"hljs-params\">doc</span> =&gt;</span> {\n      <span class=\"hljs-keyword\">return</span> moment().isSame(doc.data().deadline, <span class=\"hljs-string\">'day'</span>)\n    }).map(<span class=\"hljs-function\"><span class=\"hljs-params\">doc</span> =&gt;</span> {\n      <span class=\"hljs-keyword\">return</span> {\n        <span class=\"hljs-attr\">notificationKey</span>: doc.data().notificationKey,\n        <span class=\"hljs-attr\">title</span>: doc.data().title,\n        <span class=\"hljs-attr\">id</span>: doc.id\n      }\n    })\n  } <span class=\"hljs-keyword\">catch</span> (error) {\n    <span class=\"hljs-keyword\">throw</span> error\n  }\n}\n\n<span class=\"hljs-comment\">// pushé€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹</span>\n<span class=\"hljs-keyword\">async</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">DeadlineDocument</span>(<span class=\"hljs-params\">documents</span>) </span>{\n  <span class=\"hljs-keyword\">const</span> url = <span class=\"hljs-string\">\"https://fcm.googleapis.com/fcm/send\"</span>\n  <span class=\"hljs-keyword\">const</span> headers = {\n    <span class=\"hljs-string\">'Authorization'</span>: <span class=\"hljs-string\">'key='</span> + functions.config().vue_app.server_key,\n  }\n\n  <span class=\"hljs-keyword\">try</span>{\n    <span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">let</span> <span class=\"hljs-built_in\">document</span> <span class=\"hljs-keyword\">of</span> documents) {\n      <span class=\"hljs-keyword\">let</span> data = {\n        <span class=\"hljs-string\">\"notification\"</span>: {\n          <span class=\"hljs-string\">\"title\"</span>: <span class=\"hljs-string\">\"ã€Œ\"</span> + <span class=\"hljs-built_in\">document</span>.title + <span class=\"hljs-string\">\"ã€ã¯ä»Šæ—¥ç· ã‚åˆ‡ã‚Šã§ã™\"</span>, <span class=\"hljs-comment\">//é€šçŸ¥ã®ã‚¿ã‚¤ãƒˆãƒ«</span>\n          <span class=\"hljs-string\">\"click_action\"</span>: <span class=\"hljs-string\">\"result/\"</span> + <span class=\"hljs-built_in\">document</span>.id <span class=\"hljs-comment\">//é€šçŸ¥ã‚’æŠ¼ã—ãŸæ™‚ã®é£›ã³å…ˆ</span>\n        },\n        <span class=\"hljs-string\">\"to\"</span>: <span class=\"hljs-built_in\">document</span>.notificationKey <span class=\"hljs-comment\">//ãƒˆãƒ¼ã‚¯ãƒ³</span>\n      }\n\n      axios.post(url, data, {<span class=\"hljs-attr\">headers</span>: headers, <span class=\"hljs-attr\">useCredentails</span>: <span class=\"hljs-literal\">true</span>})\n\n      <span class=\"hljs-keyword\">await</span> sleep(<span class=\"hljs-number\">2000</span>)\n    }\n\n    <span class=\"hljs-keyword\">return</span> documents\n  } <span class=\"hljs-keyword\">catch</span> (error) {\n    <span class=\"hljs-keyword\">throw</span> error.response.status\n  }\n}\n\n<span class=\"hljs-comment\">// ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹é–¢æ•°</span>\nexports.pushNotification = functions.https.onRequest(<span class=\"hljs-keyword\">async</span> (request, response) =&gt; {\n  <span class=\"hljs-keyword\">try</span>{\n    <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> getNotificationDocument()\n    <span class=\"hljs-keyword\">const</span> today = <span class=\"hljs-keyword\">await</span> pushNotificationTodaysDeadlineDocument(res.today)\n    response.send(today)\n  } <span class=\"hljs-keyword\">catch</span> (error) {\n    response.status(<span class=\"hljs-number\">500</span>).send(error)\n  }\n})</code></pre><p>ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§functionã‚’ãƒ‡ãƒ—ãƒ­ã‚¤</p>\n<pre><code class=\"hljs\">$ firebase deploy --only <span class=\"hljs-built_in\">functions</span>\n\nFunction URL (addMessage): https://MY_PROJECT.cloudfunctions.net/pushNotification</code></pre><p>FunctionURLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ã€pushé€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã‚Œã°æˆåŠŸã§ã™â—</p>\n<h3>5-4. Cronã§é–¢æ•°ã‚’å®šæœŸå®Ÿè¡Œ</h3>\n<p>Firebaseã®ã¿ã§å®šæœŸå®Ÿè¡Œã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€èª²é‡‘ãŒå¿…è¦ã§ã™ã€‚\nhttps://firebase.google.com/docs/functions/schedule-functions</p>\n<p>ä»Šå›ã¯ã€ç„¡æ–™ã§å®Ÿè£…ã—ãŸã‹ã£ãŸãŸã‚ã€å¤–éƒ¨ã®Cronã‚’åˆ©ç”¨ã—ã¾ã—ãŸã€‚</p>\n<ul>\n<li><a href=\"https://cron-job.org/en/\">cron-job.org</a>ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€TOPç”»é¢ã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹</li>\n<li>ã€ŒCronjobsã€ã‚¿ãƒ–ã®ã€Œ+Create cronjobã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€æ–°è¦jobã‚’ä½œæˆ</li>\n<li>titleã¨FunctionURLã€ä»»æ„ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®šã—ã€jobã‚’ä½œæˆ</li>\n</ul>\n<p>ã“ã‚Œã§è¨­å®šãŒã†ã¾ãã„ã£ã¦ã„ã‚Œã°ã€è¨­å®šã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã§é€šçŸ¥ã•ã‚Œã¾ã™ğŸ‰</p>\n<h2>æ„Ÿæƒ³</h2>\n<p>CloudMessagingã¯åˆã‚ã¦åˆ©ç”¨ã—ã¾ã—ãŸãŒã€æƒ³åƒä»¥ä¸Šã«ç°¡å˜ã«pushé€šçŸ¥ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚\nPWAåŒ–ã‚‚VueCLIã‚’åˆ©ç”¨ã™ã‚Œã°ã€æ‰‹é–“ç„¡ãå®Ÿè£…ã§ãã¾ã—ãŸã€‚</p>\n<p>PWAã¯iOSã®å¯¾å¿œçŠ¶æ³ãŒèŠ³ã—ããªã„ã®ã§ã€ä»Šå¾Œã«æœŸå¾…ã§ã™ã€‚ã€‚ã€‚ğŸ˜”</p>\n<p>åŸç¨¿ç”¨ç´™ã®è¡¨ç¤ºéƒ¨åˆ†ã¯æ€ã„ã¤ãã¨ãƒã‚«ãƒ©ãƒ¯ã‚¶ã§å®Ÿè£…ã—ãŸã®ã§ã€ãƒã‚°ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚ã€‚\nä¸å…·åˆãªã©è¦‹ã¤ã‘ãŸã‚‰ã”æŒ‡æ‘˜ã„ãŸã ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™m(_ _)m</p>\n",
  "dir": "contents/blog/json",
  "base": "2019-12-docment-counter.json",
  "ext": ".json",
  "sourceBase": "2019-12-docment-counter.md",
  "sourceExt": ".md"
}